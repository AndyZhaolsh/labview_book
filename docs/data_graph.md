# 图形化显示数据

能够方便的把数据以图形化的方式展现出来，是LabVIEW的一大特色。LabVIEW为此提供了丰富的控件和函数，可以大大简化图形化显示数据的复杂度。这一节的示例程序大量使用了循环结构，读者也可以先学习了[循环结构](structure_loop)后再来阅读本节内容。

![images_2/image74.png](images_2/image74.png "图形控件选板")

LabVIEW 图形控件选板上列出了几十种控件，本别用于显示不同类型的数据。但实际上，真正用于显示的部分，不需要分成那么多种控件，比如，一个图片控件既可以显示显示用直角坐标系表示数据，也可以显示用极坐标系表示的数据。所以，读者们可能已经发现了，这个选板上的很多控件被拖到前面板上时，它还会在VI的程序框图上添加一些代码。这些代码是真正用来处理不同类型的数据的，它们把不同类型的数据转换为图形控件可以显示的方式，再使用底层图形控件把数据绘制出来。

这个选板上的大多数控件用来显示2维图形数据，另一部分控件可以用来显示3维图形数据。

## 波形图表和波形图

我们先来开一下，最常用的数据曲线显示控件，波形图表和波形图控件。所谓曲线就是一组随时间变化的数值数据，曲线也可以被称为波形。我们通常在一个直角坐标系中用X轴表示时间，Y轴表示数据值。 

### 图表与图的区别

在图形控件选板上的波形图（Waveform）和强度图（Intensity），都有对应的图表（Chart）和图（Graph）。图表和图的功能非常类似，最主要的区别在于当图表自带一块缓存，历史数据会被保存在缓存中。当图表接收到新的数据时，它不会把原来显示的图形清除，而是在原图形基础上再把新数据添加上。图没有缓存，每次接受到新的数据，就会把旧图清除，只显示新的数据。

在实际应用中，图表适合显示低速变化的数据，比如某一程序每秒钟读取显示一次锅炉的温度，就可以使用波形图表。这样不但能够显示当前数据，还可以为用户提供历史数据，直接观察到温度的变化趋势。如果程序展示的是瞬时的高速采集数据，就无需逐点显示数据了。比如，程序在0.01秒内采集了1000个被测物体的震动信号数据，即便在0.01秒内逐个画出1000个点，人眼也无法看到绘图的过程。这种情况更适合在采集完全部1000个数据后，使用波形图控件直接显示全部数据。

在VI前面板上新加一个波形图表控件，会发现它在程序框图上的数据类型是DBL的实数数值类型；在VI前面板上新加一个波形图控件，会发现它在程序框图上的数据类型是实数数组类型。波形图表控件的数据端通常会放在一个循环内，每次循环迭代为波形图表提供一个数据；波形图控件则每次接受一组数据，然后全部显示出来。比如下图中的程序，绘制了一条带有噪声的正弦波信号。波形信号被本别传递给了一个波形图表和一个波形图控件，但传递方式有所不同：

![images_2/image77.png](images_2/image77.png "绘制波形图程序")

运行VI，会看到波形图表和波形图控件最终显示的数据曲线完全相同。区别在于程序的运行过程中，

![images_2/image78.png](images_2/image78.gif "绘制波形图表过程")

这时候如果再次运行VI，会发现波形图表上的旧数据并没有被清除，而是在后面继续添加的新数据。如果希望每次程序启动时，都是一个全新的开始，可以在程序中通过波形图表的属性节点，清空它的历史数据，之后再运行程序：

![images_2/image79.png](images_2/image79.png "清空波形图表历史数据")

我们一可以使用同样的属性节点在程序运行当中，清楚波形图表控件的历史数据，或者为它设置一些初始的历史数据。


### 显示多条波形曲线

我们之前介绍的各种控件，大多都是每个控件对应一种数据类型，比如开关控件接受布尔类型的数据，文本框控件接受字符串数据类型等。但是波形图表和波形图控件，除了默认的数值和数值数组类型之外，还可以接受其它多种不同数据类型，并且根据不同的输入数据类型采取不同的数据显示方式。

波形图表控件也可以接受数值数组数据，这时，它会一次把输入的一组数据都添加在波形显示区。如果我们把上面的例子稍作修改，在循环外，把生成的数组数据同时传给波形图表和波形图控件，会发现这时候两个控件的行为完全一致：

![images_2/image80.png](images_2/image80.png "给波形图表传递数组数据")

波形图表和波形图控件都可以用来显示多条波形曲线，一个直觉的想法是：既然一维数组可以表示一条曲线，那么二维数组就应当可以表示多条曲线。我们的确可以把二维数组数据传递给波形图表和波形图控件，让他们显示多条曲线，但是需要注意的是，这两个控件接受的二维数组数据是具有不同格式的：

* 波形图控件接受的二维数组数据中，每一行代表一条曲线，每一列代表一个时刻的数据；
* 波形图表控件正相反，它接受的二维数组数据中，每一列代表一条曲线，每一行代表一个时刻的数据。

比如下面这个程序，波形图表和波形图控件显示的曲线图案完全相同，但是输入的数据，一个却是另一个的转置：

![images_2/image81.png](images_2/image81.png "波形控件接受二维数组数据")

这也是因为两个控件使用场景的不同：波形图每次绘制一条曲线，然后再绘制另一条曲线；波形图表控件每次绘制一个时间点所有曲线的数据，然后再绘制下一个时间点的数据。另一种波形控件常用的数据类型是簇数组（Array of Cluster），与上面的规则类似：

* 波形图控件接受的簇数组数据中，每个簇代表一条曲线；
* 波形图表控件接受的簇数组数据中，每个簇代表一个时刻的数据。

下图中程序产生的结果与上面的示例完全相同：

![images_2/image82.png](images_2/image82.png "波形控件接受簇数组数据")

波形图表控件提供了两种方式显示多条曲线。波形图表控件的鼠标右键菜单中，可以选择“堆叠模式（Stack Plots）”或者“覆盖模式（Overlay Plots）”。覆盖模式是默认的模式，就是多条曲线显示在同一张图上；堆叠模式则视为每个曲线单独绘制一张小图：

![images_2/image83.png](images_2/image83.png "波形图表的控件堆叠模式")

堆叠模式的一个用途是，有时候两个（或多个）曲线的Y轴数据范围差距较大，不适合放在同一张图中。比如下图中的两条曲线，由于它们的幅值差距较大，在同一个坐标系中，幅值较小的那一条曲线的细节部分就看不清楚。

![images/image464.png](images/image464.png "两条幅值差距较大的曲线")

这时，可以使用堆叠模式，把两个曲线分别显示。但是波形图控件虽然没有堆叠模式，或者在波形图表控件中我们也还是希望把两个曲线显示在同一张图上，以便比较。那么我们还可以为它们设置不同的坐标系，以便把两条曲线的整体和细节都展现得清清楚楚。

在波形图坐标轴的标尺上点击鼠标右键，选择"复制标尺"，可以为波形图添加一条额外的标尺。每个标尺的刻度可以是不同的，在波形图的属性对话框中或图例的右键菜单中可以选择每个曲线采用哪一个标尺。采用不同的标尺，可以使波形图中每条曲线的显示都达到最佳效果：

![images/image465.png](images/image465.png "使用不同标尺显示的多条曲线")


## 波形数据类型

到目前为止，我们一直在使用数组的索引来表示曲线的时间信息，但在很多实际应用中，是需要显示曲线的实际时间信息的。比如，如果一段数据采集与2021年12月18日上午9点01分01秒至2021年12月18日上午9点01分02秒，这些时间信息需要被显示在波形图的横轴上以方便用户理解数据。这就需要把时间信息和数据的值一同传递给波形控件才行。在LabVIEW中，我们可以把时间信息和波形数据一起打包成一个簇。不过LabVIEW已经定义了一个特殊的簇类型，专用于保存待时间的波形数据，这就是波形数据类型。

波形数据类型包含四个元素：t0（采样起始时间）、dt（采样间隔时间）、Y（数据，一维数组表示的每个点对应Y轴上的值）、attributes（波形的一些属性）。由于波形包含的信息多于单纯的数组，所以程序中应当尽量以波形数据类型来表示采集到的数据。有关波形数据的函数都在LabVIEW的函数面板的“编程->波形”中。

下图中的程序生成了一个波形数据。它使用系统当前的时间作为波形的起始时间，采样间隔是0.1秒。

![images/image460.png](images/image460.png "手动构造一个波形数据")

既然波形中包含了时间信息，那么在表示它的时候，X轴直接显示时间信息会更加直观。若需要波形图控件的横坐标显示时间，只要调整它的显示格式即可。鼠标右键点击波形图控件的横坐标，选择"格式化"即可对其显示格式进行配置。它的设置方式与普通数值控件显示格式的设置方式相同（参考[数值控件及其显示格式](data_number)）。直接选择"绝对时间"格式即可在X坐标标尺上显示时间，也可以使用高级设置选择自定义的显示格式：

![images_2/image84.png](images_2/image84.png "设置波形控件X轴显示格式")

波形图控件默认状态下，是通过直接修改坐标的起始值来设置X轴的时间信息的，所以当我们需要使用波形数据携带的时间信息时，需要把“忽略波形数据的时间戳（Ignore waveform time stamp on x-axes）”这个选项取消才行：

![images_2/image85.png](images_2/image85.png "使用波形数据中的时间信息")

程序运行结果如下：

![images/image461.png](images/image461.png "以时:分:秒格式显示的波形图横坐标")


使用"设置波形属性"和"获取波形属性"可以读写波形数据中的属性。波形中可以保存一些任意名称和任意类型数据的属性。采集数据时的某些信息，如通道名称、单位、放大倍数等，这些信息在后续的程序中也许还要用到，就可以把它们当作波形数据的属性保存下来，并传给后续程序。后续程序在需要用到这些信息时，可以从波形数据中把它们读出来。这两个函数分别有一个名为"名称"的输入或输出接线端。在程序中，某些名称的属性具有特殊用途。比如，"NI_ChannelName"表示通道名称。设置了这个属性，波形图中的通道名称会自动更新。在这两个函数的帮助文件中，可以查看到这些特殊含义的名称属性的详细信息。

![images/image462.png](images/image462.png "设置波形属性")

![images/image463.png](images/image463.png "设置了NI_ChannelName的值，波形图控件中的通道名会自动更新")

使用波形数据的一个额外好处，波形图表和波形图控件可以接受同样格式的数据，并且显示出同样的结果了，这两个控件都可以接受波形数据的数组然后显示出多条曲线。比如下面的程序：

![images_2/image86.png](images_2/image86.png "波形控件接受波形数组数据")

程序运行结果：

![images_2/image87.png](images_2/image87.png "两种波形控件对于波形数据的行为一致")

## 波形控件的交互功能

（待添加）

## XY图形控件（XY Graph）

波形图控件处理的数据有一个特征，它的时间信号是有序等间隔的。对于这种数据，通常只需要用一个一维数组，表示每一个时间点上Y轴的数据即可。如果还需要具体的时间数据，也不需要把每个时间点的数据保存下来，只需要一个初始时间值，和一个间隔值即可。但是，有时候除了波形曲线，我们还需要绘制一些其他类型的曲线，它们的X轴可能并不是有序的，或者不是等间隔的。对于这样的数据，就还需要一个一维数组，来表示数据在X轴上的每一个数值。这一类由一组对应的X和Y的值组成的数据，可以使用 XY图形控件（XY Graph）显示。

我们通常会用XY图形数据来展现两组数据之间的关系。比如，在测控领域，常常用它来展示一组采集数据中两个通道的数据之间的关系；在数据统计或人工智能等领域，常常用它来展示一个数据集中，某个特征量的分布，或者两个特征之间的关系等。

### 展示两个信号通道之间的关系

下图是一个简单示例，它把相位相差90度的两个正弦波数据分别作为X和Y轴的数据输入XY图形控件：

![images_2/image88.png](images_2/image88.png "使用XY图形控件显示一些模拟数据")

如果没有噪音，图像应该是一个正圆。因为加入了一些随机数，XY图形控件显示的是一个带有不规则锯齿的圆圈：

![images_2/image89.png](images_2/image89.png "使用XY图形控件显示一些模拟数据")

很多示波器具有绘制利萨茹曲线的功能，其实就是把两个信号通道的数据分别作为X和Y轴绘制的ＸＹ图形，通过绘制出的曲线可以比较直观的显示出两个通道信号的频率和相位差。下图的程序是一个简单示例，为了简化编程负责度，程序使用了几个[Express VI](measurement_express_vi)生成演示所需的两个通道的正弦波信号，两个通道信号的频率分别为3Hz和4Hz：

![images_2/z001.png](images_2/z001.png "生成频率比为3/4的两个通道信号")

输入频率比为3/4的两个信号的利萨茹曲线如下：

![images_2/z002.png](images_2/z002.png "频率比为3/4的两个通道信号的利萨茹曲线")

### 数据分析

文本文件“weight_height.csv”中，保存了收集自一万个人的数据。每个人包含三个特征数据：性别、身高、体重。如果我们需要观察一下，看看人的身高与体重之间是否有相关性，那么可以以身高作为X轴，以体重作为Y轴，把每一个人的身高体重显示在坐标系对应的位置上。这样就可以大致看出体重相对于身高的分布规律了。XY图形控件也可以接受多通道数据，所以我们可以按照性别把数据分为男女两个通道。下图是示例ＶＩ的程序框图：程序首先从ｃｓｖ文件中读出数据，再按照性别把数据整理至４个一维数组，分别代表：男性身高、男性体重、女性身高、女性体重，最后分别把男女的数据绑定为XY图形数据显示出来：

![images_2/image90.png](images_2/image90.png "使用XY图形控件显示身高体重数据")

这个示例中的数据都是离散的，每个人之间的数据没什么关联。所以这个示例中不需要用线把图形中的每个点连接上。只要在每个有数据的地方画一个点即可。

![images_2/image91.png](images_2/image91.png "设置显示使用离散点而非曲线")

程序使用蓝色代表男性数据，红色代表女性数据。程序运行结果如下图所示：

![images_2/image92.png](images_2/image92.png "使用XY图形控件显示身高体重数据")

可以明显的看到数据分布在一条倾斜的狭长地带上，身高与体重之间有比较明显的正相关性。如果需要看一下身高与体重各自的分布情况，也可以使用XY图形控件来显示。程序逻辑与上图的示例相似，区别仅在于最后显示的数据。子这里我们使用身高作为X轴，在每一身高区间范围内的人数左右Y轴，就可以看到在身高维度上人数的分布。时候类似的方法，也可以查看人数在体重维度上的分布。

![images_2/image93.png](images_2/image93.png "使用XY图形控件显示身高体重分布")

查看数据在某一维度上的分布常常使用柱状图，当然，曲线图也可以：

![images_2/image94.png](images_2/image94.png "使用XY图形控件显示身高体重分布")

可以看出男女的数据分布虽然有重叠，但峰值部分还是明显分开的。

## 强度图(Intensity Graph)

XY图形在每一个坐标点只有两个选项：有数据或者没有数据。但有的时候我们需要在每个坐标点上展示更复杂的信息，不仅仅是有或无，而是一个大小可变的数值。这时候数据已经从二维变成了三维，除了X、Y轴的数据，还有一个Z轴上的数据。LabVIEW常用两种方法来展示三维数据，一种方法是使用三维图形控件，但是这一段我们着重介绍第二种方法，使用强度图来展示三维数据。强度图依然是一个二维图，与XY图有些相似，但是它可以使用像素的亮度或颜色来表示三维数据在Z轴上的数值。

### 时频联合谱图

在测控领域，使用波形图只能表达两维信息量。比如常常用横轴表示时间或频率，而用纵轴表示幅值或能量。但有时候我们需要更复杂的分析方法，比如真实信号的能量在不同频率的分布常常是随着时间变化而改变的。如果要把这一变化显示出来，就需要借助有三维信息的图形，分别显示时间、频率、功率。我们可以使用强度图来表示这个三维信息，则除了横纵轴分别表示时间和频率，再使用颜色变化来表示第三维的功率信息。某些音频播放软件提供了时频联合分析的功能，即在一张图上以颜色表示声音能量在不同时段和频率上的分布。使用LabVIEW编程可以实现同样的功能。下图
是实现这一功能的一段程序。它的实现方法是比较简单的，把声音分成小的片段，比如每秒钟一段，然后分析这一段时间内，声音功率在不同频率上的分布，最后把每一秒钟的分析结果合并在一起，就得到这一数据随时间变化的图谱了。

![images/image472.png](images/image472.png "对声音文件的功率分布进行分析")

在选取时间片长度的时候需要注意：如果时间片选取的太短，时频联合分析结果在频域上的分辨率就会比较低；而如果时间片太长，时频联合分析结果在时域上的分辨率会降低。这两个分辨率是矛盾的，此消彼长。对于音乐和语音来说，一般每秒钟最多包含四五个音节，所以选取每200毫秒为一个时间片是比较合适的。

下图是一首钢琴曲的时频能量谱图。从这张图上可以清楚的看出钢琴曲不同音符的跳跃变化。如果需要编写一个程序，把一段音乐转成曲谱，或把录制的电话拨号音还原为电话号码，那么第一步就可以采取上述方式进行时频联合分析。然后得到谱图中高亮部分信号的频率，再将频率转换成相应的音符或电话拨号即可。

![images/image473.png](images/image473.png "声音能量在不同时段和频率上的分布")


如果把程序改为从声卡或其它数据采集设备中读入数据，就可以对采集到的信号进行实时分析了。如果还安装了“Advanced Signal Processing Toolkit”工具包，信号处理会变得更加容易。这个工具包包含了针对时序信号分析、时频联合分析以及小波分析所需的各种函数和工具。

例如上文提到的时频分析运算过程，使用"Advanced Signal Processing Toolkit"工具中的一个"STFT Spectrogram"Express VI就可以完成。工具包中还提供了其它LabVIEW中没有的时频联合分析方法，如Gabor Spectrogram、Adapt Spectrogram等。此外，使用此工具还可以对得到的时频联合谱图做进一步处理，如把谱图上某一区域的信号分离出来。

![images/image474.png](images/image474.png "使用STFT Spectrogram Express VI计算信号的时频联合谱图")

![images/image475.png](images/image475.png "STFT Spectrogram Express VI的配置对话框")

### 数据分析
